<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Limpar Cache do Service Worker</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #0f172a;
            color: white;
        }
        .container {
            background: #1e293b;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        h1 {
            color: #6941DE;
            margin-bottom: 20px;
        }
        button {
            background: #6941DE;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: all 0.2s;
        }
        button:hover {
            background: #5533cc;
            transform: translateY(-2px);
        }
        button:disabled {
            background: #475569;
            cursor: not-allowed;
            transform: none;
        }
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            background: #334155;
        }
        .success {
            background: #22c55e;
            color: white;
        }
        .error {
            background: #ef4444;
            color: white;
        }
        .info {
            background: #3b82f6;
            color: white;
        }
        .log {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-bottom: 1px solid #334155;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üßπ Limpar Cache do Service Worker</h1>
        <p>Use esta p√°gina para for√ßar a atualiza√ß√£o do Service Worker e limpar todo o cache.</p>

        <div>
            <button onclick="clearCache()">Limpar Todo Cache</button>
            <button onclick="unregisterSW()">Desregistrar Service Worker</button>
            <button onclick="reloadPage()">Recarregar P√°gina</button>
            <button onclick="fullReset()">Reset Completo</button>
        </div>

        <div id="status" class="status" style="display: none;"></div>

        <div class="log" id="log">
            <div class="log-entry">Aguardando a√ß√£o...</div>
        </div>
    </div>

    <script>
        function addLog(message, type = 'info') {
            const log = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.style.color = type === 'success' ? '#22c55e' : type === 'error' ? '#ef4444' : '#3b82f6';
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
            addLog(message, type);
        }

        async function clearCache() {
            try {
                addLog('Iniciando limpeza de cache...');
                const cacheNames = await caches.keys();
                addLog(`Encontrados ${cacheNames.length} caches`);

                for (const cacheName of cacheNames) {
                    await caches.delete(cacheName);
                    addLog(`‚úì Cache deletado: ${cacheName}`, 'success');
                }

                showStatus('‚úÖ Cache limpo com sucesso!', 'success');
                addLog('Cache totalmente limpo!', 'success');
            } catch (error) {
                showStatus('‚ùå Erro ao limpar cache: ' + error.message, 'error');
                addLog('Erro: ' + error.message, 'error');
            }
        }

        async function unregisterSW() {
            try {
                addLog('Desregistrando Service Workers...');
                const registrations = await navigator.serviceWorker.getRegistrations();
                addLog(`Encontrados ${registrations.length} Service Workers`);

                for (const registration of registrations) {
                    await registration.unregister();
                    addLog(`‚úì Service Worker desregistrado: ${registration.scope}`, 'success');
                }

                showStatus('‚úÖ Service Worker desregistrado!', 'success');
                addLog('Todos os Service Workers foram removidos', 'success');
            } catch (error) {
                showStatus('‚ùå Erro ao desregistrar SW: ' + error.message, 'error');
                addLog('Erro: ' + error.message, 'error');
            }
        }

        async function reloadPage() {
            addLog('Recarregando p√°gina em 2 segundos...', 'info');
            showStatus('üîÑ Recarregando p√°gina...', 'info');
            setTimeout(() => {
                window.location.reload(true);
            }, 2000);
        }

        async function fullReset() {
            try {
                addLog('=== INICIANDO RESET COMPLETO ===');

                // 1. Limpar cache
                addLog('Passo 1: Limpando cache...');
                const cacheNames = await caches.keys();
                for (const cacheName of cacheNames) {
                    await caches.delete(cacheName);
                    addLog(`‚úì Cache deletado: ${cacheName}`, 'success');
                }

                // 2. Desregistrar SW
                addLog('Passo 2: Desregistrando Service Workers...');
                const registrations = await navigator.serviceWorker.getRegistrations();
                for (const registration of registrations) {
                    await registration.unregister();
                    addLog(`‚úì SW desregistrado: ${registration.scope}`, 'success');
                }

                // 3. Limpar localStorage
                addLog('Passo 3: Limpando localStorage...');
                const localStorageKeys = Object.keys(localStorage);
                addLog(`Encontradas ${localStorageKeys.length} chaves no localStorage`);

                // 4. Limpar sessionStorage
                addLog('Passo 4: Limpando sessionStorage...');
                sessionStorage.clear();
                addLog('‚úì sessionStorage limpo', 'success');

                showStatus('‚úÖ Reset completo realizado!', 'success');
                addLog('=== RESET COMPLETO FINALIZADO ===', 'success');
                addLog('Recarregando em 3 segundos...', 'info');

                setTimeout(() => {
                    window.location.reload(true);
                }, 3000);
            } catch (error) {
                showStatus('‚ùå Erro no reset: ' + error.message, 'error');
                addLog('Erro: ' + error.message, 'error');
            }
        }

        // Auto-detect SW status on load
        window.addEventListener('load', async () => {
            try {
                const registrations = await navigator.serviceWorker.getRegistrations();
                addLog(`Service Workers ativos: ${registrations.length}`);

                const cacheNames = await caches.keys();
                addLog(`Caches existentes: ${cacheNames.length}`);

                if (registrations.length > 0) {
                    addLog('‚ö†Ô∏è Service Worker detectado. Clique em "Reset Completo" para atualizar.', 'info');
                }
            } catch (error) {
                addLog('Erro ao verificar status: ' + error.message, 'error');
            }
        });
    </script>
</body>
</html>
